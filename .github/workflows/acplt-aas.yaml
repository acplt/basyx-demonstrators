name: acplt-aas

on:
  push:
    paths: 
      - .github/workflows/acplt-aas.yaml
      - acplt/aas/**
      - '!acplt/aas/**/README.md'
    branches:
      - acplt-aas

jobs:
  build_aas_repository:
    runs-on: [windows-latest]
    steps:
    - uses: actions/checkout@v2
      with:
        submodules: recursive
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pyinstaller
        pip install -r acplt\aas\requirements.txt
    - name: Create Asset Administration Shells
      run: |
        cd acplt/aas/aas_repository_server
        python aas_generator/cc_identifier_to_endpoint_address.py
    - name: Build AAS Repository Server Executable
      run: |
        pyinstaller acplt\aas\aas_repository_server\aas_repository_server.spec
    - name: Archive AAS Repository Server
      uses: actions/upload-artifact@v3
      with:
        name: acplt-aas
        path: dist\*
